<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <title>Drawing and updating</title>
  </head>
  <body>
    <div id="target">
      <p>
        Target positions will be shown here.
      </p>
    </div>
    <div id="game">
      <canvas id="game-canvas"></canvas>
    </div>
    <div id="editor"> </div>
    <div id="editor-controllers">
      <a id="load-link">Load</a>
      <a id="run-link">Run</a>
      <a id="step-link">Step</a>
    </div>
  </body>

  <!--load game library and the game -->
  <script src="luv.js"></script>

  <script src="game-js/utils.js"></script>
  <script src="game-js/config.js"></script>
  <script src="game-js/world.js"></script>

  <script src="game-js/engine.js"></script>
  <script src="game-js/gui.js"></script>

  <script src="game-js/game.js"></script>

  <!-- load the editor -->
  <script src="codemirror-compressed.js"></script>
  <script src="botlang/mode.js"></script>
  <link rel="stylesheet" href="codemirror-3.11/lib/codemirror.css">
  <link rel="stylesheet" href="codemirror-3.11/theme/ambiance.css">

  <!-- load parser -->
  <script src="game-js/parser.js"></script>

  <script type="text/javascript">
    // OMG javascript sucks so hard ..
    // var id = document.getElementById doesn't work for some reason, but this works fine.
    // this is stupid.
    var id = function (s) { return document.getElementById(s); }
    CodeMirror.defineMode("botlang", BotlangMode);
    var cm = CodeMirror(id("editor"), { theme: "ambiance", lineNumbers: true, mode: "botlang" });


    var runBtn = id("run-link");
    var stepBtn = id("step-link");
    var loadBtn = id("load-link");

    var lvl = new Level(
      fixColHeights([["b", "r", "g", "y"], [], []]),
      fixColHeights([[], [], ["b", "r", "g", "y"]]));

    var program = parser.parse("program1: move left move left down down");

    var gui = new Gui()
    var engine = new GameEngine(lvl, program, gui, true)

    loadBtn.onclick = function () {
      var val = parser.parse(cm.doc.getValue());
      console.log(val);
      engine = new GameEngine(lvl, val, gui, true)
    };

    stepBtn.onclick = function () {
      engine.step()
    };

    //Game.loadLevel([ "ggg", "rrr", "ggg", "rgb", "bgr", "rgb", "bbb", "rrr", "ggg", "rrr" ]);
  </script>


</html>
